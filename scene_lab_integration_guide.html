<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Scene Lab: Integration Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,700" rel="stylesheet">
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="commonprojectlogo">
    <img alt="Logo" src="fpl_logo_small.png"/>
  </td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Scene Lab
   </div>
   <div style="font-size:12px;">
	 An open source project by
     <a href="https://developers.google.com/games/#Tools">FPL</a>.
  </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="scene_lab_using.html"><span>Using&#160;Scene&#160;Lab</span></a></li>
      <li><a href="usergroup0.html"><span>Programmer's&#160;Guide</span></a></li>
      <li><a href="usergroup1.html"><span>API&#160;Reference</span></a></li>
      <li><a href="scene_lab_readme.html"><span>Readme</span></a></li>
      <li><a href="contributing.html"><span>Contributing</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('scene_lab_integration_guide.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Integration Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Library Integration</h1>
<p>To use Scene Lab via <a href="http://www.cmake.org/">CMake</a>, add the library to your CMakeLists.txt.</p>
<div class="fragment"><div class="line">set(SCENE_LAB_DIR ${CMAKE_SOURCE_DIR}/[path to scene lab]/scene_lab)</div>
<div class="line">set(MY_OBJ_DIR ${CMAKE_BINARY_DIR}/obj)  # or similar</div>
<div class="line">add_subdirectory(<span class="stringliteral">&quot;${SCENE_LAB_DIR}&quot;</span> ${MY_OBJ_DIR}/scene_lab)</div>
</div><!-- fragment --><p>You will have to add <a class="el" href="namespacescene__lab.html" title="Utility functions that might be useful if you are using Scene Lab. ">scene_lab</a>'s schemas directory to your flatc command line as an include directory.</p>
<div class="fragment"><div class="line">[flatc command line] -I ${SCENE_LAB_DIR}/schemas</div>
</div><!-- fragment --><p>And add Scene Lab's include directories to your include directories:</p>
<div class="fragment"><div class="line">include_directories(${SCENE_LAB_FLATBUFFERS_GENERATED_INCLUDES_DIR})</div>
<div class="line">include_directories(${SCENE_LAB_DIR}/include)</div>
</div><!-- fragment --><p>If you'd like to output your world's FlatBuffers files as JSON files, you will need to include the FlatBuffers parser in your project:</p>
<div class="fragment"><div class="line">set(my_project_SRCS</div>
<div class="line">    ...  # lots of other source files</div>
<div class="line">    ${dependencies_flatbuffers_dir}/src/idl_parser.cpp</div>
<div class="line">    ${dependencies_flatbuffers_dir}/src/idl_gen_text.cpp</div>
<div class="line">)</div>
</div><!-- fragment --><p>And finally, link <a class="el" href="namespacescene__lab.html" title="Utility functions that might be useful if you are using Scene Lab. ">scene_lab</a> into your project.</p>
<div class="fragment"><div class="line">target_link_libraries(my_project</div>
<div class="line">    ...  # lots of other libraries to link in</div>
<div class="line">    scene_lab</div>
<div class="line">)</div>
</div><!-- fragment --><h2>Prerequisites</h2>
<p>Scene Lab is designed to be integrated into a game built using <a href="https://google.github.io/corgi/">CORGI</a> and <a href="https://google.github.io/flatbuffers/">FlatBuffers</a>. In order to take full advantage of Scene Lab's in-engine world editing capabilities, you should be using CORGI's included component library as the basis for your entities. Specifically you will need to use the <a href="https://google.github.io/corgi/transform_component.html">TransformComponent</a>, <a href="https://google.github.io/corgi/render_mesh_component.html">RenderMeshComponent</a>, and <a href="https://google.github.io/corgi/physics_component.html">PhysicsComponent</a> (to be able to click on entities via ray-casting), as well as <a href="https://google.github.io/corgi/meta_component.html">MetaComponent</a> for keeping track of entity IDs and prototypes.</p>
<p>You must also use a version of <a href="https://google.github.io/corgi/entity_factory.html">EntityFactory</a> that supports prototypes. The entity factory included with CORGI's component library is a good place to start.</p>
<p>Note: If you roll your own custom replacement for the RenderMeshComponent, PhysicsComponent, TransformComponent, or MetaComponent, you may be able to adapt Scene Lab to use them, but that is outside the scope of this integration guide.</p>
<h2>Using the SceneLab class</h2>
<p>To integrate the editor, instantiate a <a class="el" href="classscene__lab_1_1_scene_lab.html">SceneLab</a> object, then call <a class="el" href="classscene__lab_1_1_scene_lab.html#a1843894a086c62baeb8c890d85a6f9a6">Initialize()</a>. You will also need provide a camera for the editor to use, via some subclass of <code>CameraInterface</code> of your gameâ€™s choosing; instantiate this and then pass it along via <a class="el" href="classscene__lab_1_1_scene_lab.html#ad530912584b269aba83d0a7cb4dead38">SetCamera()</a>. SceneLab will take ownership of it.</p>
<div class="fragment"><div class="line"><span class="comment">// Set up prerequisites.</span></div>
<div class="line"><span class="keyword">const</span> SceneLabConfig* scene_lab_config = ...  <span class="comment">// Get the SceneLabConfig</span></div>
<div class="line">                                              <span class="comment">// Flatbuffer contents.</span></div>
<div class="line">corgi::EntityManager* entity_manager = ...    <span class="comment">// Get CORGI&#39;s EntityManager.</span></div>
<div class="line">gui::FontManager* font_manager = ...          <span class="comment">// Get FlatUI&#39;s FontManager.</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Initialize Scene Lab.</span></div>
<div class="line">SceneLab* scene_lab = <span class="keyword">new</span> SceneLab();</div>
<div class="line">scene_lab-&gt;Initialize(scene_lab_config, entity_manager, font_manager);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Set up the camera. MyCamera is your own subclass of CameraInterface.</span></div>
<div class="line">std::unique_ptr&lt;MyCamera&gt; my_scene_lab_camera;</div>
<div class="line">my_scene_lab_camera.reset(<span class="keyword">new</span> MyCamera());</div>
<div class="line">... <span class="comment">// Set up my_camera however you want.</span></div>
<div class="line">scene_lab-&gt;SetCamera(std::move(my_scene_lab_camera));</div>
</div><!-- fragment --><p>When you are in edit mode, most <a href="https://google.github.io/corgi/">CORGI</a> components will not be updated; however, you probably want to update the <code>TransformComponent</code> and maybe others depending on your game. To set these up ahead of time before entering edit mode, call <a class="el" href="classscene__lab_1_1_scene_lab.html#a4481f0b00efdd27a49cc387d22752c83">AddComponentToUpdate()</a> multiple times, once for each component you want to update (including Transform).</p>
<div class="fragment"><div class="line"><span class="comment">// Continue to update Transform and RenderMesh while Scene Lab is active.</span></div>
<div class="line">scene_lab-&gt;AddComponentToUpdate(</div>
<div class="line">    component_library::TransformComponent::GetComponentId());</div>
<div class="line">scene_lab-&gt;AddComponentToUpdate(</div>
<div class="line">    component_library::RenderMeshComponent::GetComponentId());</div>
</div><!-- fragment --><p>To enter edit mode, simply call <a class="el" href="classscene__lab_1_1_scene_lab.html#a5d77684a5d28695ae512b7a9cdd7102d">Activate()</a>. If you want to use your in-game camera position as the initial world editor position, call <code>SetInitialCamera()</code> first.</p>
<div class="fragment"><div class="line"><span class="comment">// Did the user decide to start Scene Lab?</span></div>
<div class="line"><span class="keywordflow">if</span> (...) {</div>
<div class="line">    <span class="comment">// Tell Scene Lab to initialize its camera location based on our own in-</span></div>
<div class="line">    <span class="comment">// game camera (which must also be a subclass of CameraInterface).</span></div>
<div class="line">    scene_lab-&gt;SetInitialCamera(my_gameplay_camera);</div>
<div class="line">    <span class="comment">// Enter Scene Lab.</span></div>
<div class="line">    scene_lab-&gt;Activate();</div>
<div class="line">}</div>
</div><!-- fragment --><p>While the editor is in use, you must call <a class="el" href="classscene__lab_1_1_scene_lab.html#a59919e652de7adb338dbd8bd4f80c4a3">AdvanceFrame()</a> each frame (which will take care of updating the required components). After rendering the world each frame, call <a class="el" href="classscene__lab_1_1_scene_lab.html#af31941600ed8738b28116142b8b0b2d5">Render()</a>, which will draw the editor GUI overlay.</p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span> (...) {  <span class="comment">// Every frame.</span></div>
<div class="line">    <span class="comment">// Update Scene Lab&#39;s state, UI, etc.</span></div>
<div class="line">    scene_lab-&gt;AdvanceFrame(delta_time);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Prepare to render. Get the camera transform.</span></div>
<div class="line">    <span class="keyword">const</span> CameraInterface* camera = scene_lab_-&gt;GetCamera();</div>
<div class="line">    mat4 camera_transform = camera-&gt;GetTransformMatrix();</div>
<div class="line"></div>
<div class="line">    Renderer* renderer = ...  <span class="comment">// Get the FPLBase Renderer.</span></div>
<div class="line">    renderer-&gt;set_color(mathfu::kOnes4f);</div>
<div class="line">    renderer-&gt;DepthTest(<span class="keyword">true</span>);</div>
<div class="line">    renderer-&gt;set_model_view_projection(camera_transform);</div>
<div class="line"></div>
<div class="line">    MyWorldRenderFunction(camera, renderer); <span class="comment">// Render the world yourself.</span></div>
<div class="line"></div>
<div class="line">    scene_lab-&gt;Render(renderer);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Wait until next frame...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>You can save the current state of the world at any time by calling <a class="el" href="classscene__lab_1_1_scene_lab.html#a3d8b59884e0abc1a310c0621274ca771">SaveScene()</a>. When you are finished using the editor, call <a class="el" href="classscene__lab_1_1_scene_lab.html#a37d40a9cafafc3c6756f811373bb7355">Deactivate()</a>, and stop calling <a class="el" href="classscene__lab_1_1_scene_lab.html#a59919e652de7adb338dbd8bd4f80c4a3">AdvanceFrame()</a> and <a class="el" href="classscene__lab_1_1_scene_lab.html#af31941600ed8738b28116142b8b0b2d5">Render()</a> for now. You can re-enter the editor at any time by calling <a class="el" href="classscene__lab_1_1_scene_lab.html#a5d77684a5d28695ae512b7a9cdd7102d">Activate()</a> and resuming calling <a class="el" href="classscene__lab_1_1_scene_lab.html#a59919e652de7adb338dbd8bd4f80c4a3">AdvanceFrame()</a> and <a class="el" href="classscene__lab_1_1_scene_lab.html#af31941600ed8738b28116142b8b0b2d5">Render()</a> each frame.</p>
<div class="fragment"><div class="line"><span class="comment">// Did the user press a key indicating they want to save?</span></div>
<div class="line"><span class="keywordflow">if</span> (...) {</div>
<div class="line">    scene_lab-&gt;SaveScene();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Did the user decide to immediately exit Scene Lab without saving?</span></div>
<div class="line"><span class="keywordflow">if</span> (...) {</div>
<div class="line">    scene_lab-&gt;Deactivate();</div>
<div class="line">    <span class="comment">// Stop calling scene_lab-&gt;AdvanceFrame() and scene_lab-&gt;Render().</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Note: If you want to give the user a chance to save or discard any changes before exiting edit mode, then when the user wants to exit the editor, call <a class="el" href="classscene__lab_1_1_scene_lab.html#aa9b5d5516d7b88d6f810e10b1b095fcd">RequestExit()</a> instead of <a class="el" href="classscene__lab_1_1_scene_lab.html#a37d40a9cafafc3c6756f811373bb7355">Deactivate()</a>, and then once <a class="el" href="classscene__lab_1_1_scene_lab.html#a14c1a8000a0fb81ba0d045ac4f071a74">IsReadyToExit()</a> returns true, you can call <a class="el" href="classscene__lab_1_1_scene_lab.html#a37d40a9cafafc3c6756f811373bb7355">Deactivate()</a>.</p>
<div class="fragment"><div class="line"><span class="comment">// Did the user decide to exit Scene Lab gracefully?</span></div>
<div class="line"><span class="keywordflow">if</span> (...) {</div>
<div class="line">    scene_lab-&gt;RequestExit();</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">if</span> (scene_lab-&gt;IsReadyToExit()) {</div>
<div class="line">    scene_lab-&gt;Deactivate();</div>
<div class="line">    <span class="comment">// Stop calling scene_lab-&gt;AdvanceFrame() and scene_lab-&gt;Render().</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Even if you haven't requested to exit, you should generally check if <a class="el" href="classscene__lab_1_1_scene_lab.html#a14c1a8000a0fb81ba0d045ac4f071a74">IsReadyToExit()</a> returns true; if it is, you should treat that as if the user pressed whatever button you are using for exiting the editor. This allows the user to exit by using Scene Lab's own on-screen buttons.</p>
<h2>Using the CORGI Component Library</h2>
<p>As discussed above, Scene Lab will be at its most useful if you are taking advantage of <a href="https://google.github.io/corgi/">CORGI</a> (Component Oriented Reusable Game Interface) and its included <a href="https://google.github.io/corgi/component_library.html">component library</a>, which provides basic functionality for creating entities (<a href="https://google.github.io/corgi/entity_factory.html">EntityFactory</a>), rendering them (<a href="https://google.github.io/corgi/render_mesh_component.html">RenderMeshComponent</a>), placing them in the world (<a href="https://google.github.io/corgi/transform_component.html">TransformComponent</a>), giving them physics (<a href="https://google.github.io/corgi/physics_component.html">PhysicsComponent</a>), and managing their metadata (<a href="https://google.github.io/corgi/meta_component.html">MetaComponent</a>).</p>
<h3>Data Format</h3>
<p>CORGI's component library uses <a href="https://google.github.io/flatbuffers/">FlatBuffers</a> to store data about all of the entities in the game, as well as their prototypes. For more information on how the CORGI component library stores data, see its documentation on the <a href="https://google.github.io/corgi/">CORGI</a> site.</p>
<p>If you add your own custom components to your game (and you almost certainly will), you are responsible for creating functions to export and import the component's data for a given entity. You must implement the <code>AddFromRawData()</code> and <code>ExportRawData()</code> functions, which are symmetrical&ndash;one reads a FlatBuffer and fills out the component data based on what's inside, and one reads the component data and returns a FlatBuffer containing what's inside.</p>
<p>See the components in the CORGI <a href="https://google.github.io/corgi/component_library.html">component library</a> for examples of how to implement these functions. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-49880327-7', 'google.github.io');
ga('send', 'pageview');
</script>
</body>
</html>
